"""Prompt template for notification generation from tasks"""
from langchain_core.prompts import ChatPromptTemplate


prompt_template = ChatPromptTemplate.from_messages([
    (
        "system",
        "あなたはタスク情報から適切な通知を生成する専門家です。"
        "ユーザーに送る通知は、行動を促し、具体的で親しみやすい内容にしてください。"
        "すべての内容は必ず日本語で記述してください。"
    ),
    (
        "user",
        """以下のタスク情報を分析して、ユーザーに送る通知を生成してください。

現在の日時: {current_datetime}

タスク情報:
タイトル: {task_title}
説明: {task_description}
期限: {task_deadline}
ステータス: {task_status}
進捗: {task_progress}%

要求:
- 通知は必ず日本語で記述してください
- 現在の日時を基準に、タスクの重要度・緊急度・締切を考慮して、適切なタイミングで送る通知を生成
- 各通知には具体的な行動提案（suggestions）を3つ含める
- 通知のタイミングは段階的に（例: 準備段階、実行直前など）
- タイトルは質問形式や呼びかけ形式で親しみやすく
- contentは具体的で親しみやすく、150文字程度
- due_dateはタスクのdeadlineより前に設定（余裕を持たせる）
- suggestionsは具体的かつ実行可能なアクションにする
- 通知数は1〜2個が適切（多すぎない）
- 今すぐ着手できるアクションを含める
- 期限が迫ってきたときに状況を確認する、あるいはモチベーションを上げる通知を含める（残り時間と効果的な短時間アクション）
- 期限を過ぎた場合の「事後確認」通知を含める（終わったかどうかの確認、リカバリなど）
- 可能であれば上記の観点でいくつかの通知を用意し、重複を避けて計画性と時間感覚を補助する

通知が必要ない場合（例: タスクが既に完了している場合）は空の配列を返してください。"""
    )
])


# バッチ処理用プロンプト（複数タスクをまとめて処理）
batch_prompt_template = ChatPromptTemplate.from_messages([
    (
        "system",
        "あなたは複数のタスク情報から適切な通知を生成する専門家です。"
        "複数のタスクが同じノートから生成されている場合、関連性を考慮して通知を統合してください。"
        "すべての内容は必ず日本語で記述してください。"
    ),
    (
        "user",
        """以下の複数タスク情報を分析して、ユーザーに送る通知を生成してください。

現在の日時: {current_datetime}

タスクリスト:
{tasks_info}

要求:
- 通知は必ず日本語で記述
- 現在の日時を基準に、適切なタイミングで送る通知を生成してください
- 複数タスクに共通する期限や目標がある場合は、まとめて1つの通知にする
- 個別に通知すべきタスクは別々の通知として生成
- 各通知には具体的な行動提案（suggestions）を3つ含める
- タイトルは質問形式や呼びかけ形式で親しみやすく
- contentは具体的で親しみやすく、150-200文字程度
- 複数タスクをまとめる場合は、contentに具体的なタスク名を含める
- due_dateは各タスクのdeadlineを考慮して設定（最も早いdeadlineの前に設定）
- 通知が必要ないタスクは除外して構わない
- 今すぐ着手できる即時アクションを提案(時間は今の2分後に設定する)
- 期限間近のモチベーション喚起
- 期限超過時の事後確認・リカバリ(期限の時間に設定するが、期限がないなら適切に設定する)
- これらの通知の時間は間隔をあけて設定する
- 以上のように、計画性と時間感覚を持って通知を沢山用意してください。

通知が必要ない場合は空の配列を返してください。"""
    )
])

