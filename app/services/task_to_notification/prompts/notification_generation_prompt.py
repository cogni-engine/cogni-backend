"""Prompt template for notification generation from tasks"""
from langchain_core.prompts import ChatPromptTemplate


prompt_template = ChatPromptTemplate.from_messages([
    (
        "system",
        "あなたはタスク情報から適切な通知を生成する専門家です。"
        "ユーザーに送る通知は、行動を促し、具体的で親しみやすい内容にしてください。"
        "すべての内容は必ず日本語で記述してください。"
    ),
    (
        "user",
        """以下のタスク情報を分析して、ユーザーに送る通知を生成してください。

現在の日時: {current_datetime}

タスク情報:
タイトル: {task_title}
説明: {task_description}
期限: {task_deadline}
ステータス: {task_status}
進捗: {task_progress}%

要求:
- 通知は必ず日本語で記述してください
- 1つのノートにつき3〜5件の通知を生成してください
- 最初の通知は現在時刻の約2分後~1時間後に設定し、ノート全体に通じる汎用的かつ着手しやすい第一歩を提案してください
- 最終の通知は締切時刻（deadline）が存在する場合はその時刻ちょうどに設定し、完了確認またはフォローアップを行ってください
- 残りの通知は上記2つの間にほぼ等間隔で配置し、進捗確認や計画の見直し、モチベーションを高める内容を含めてください
- 締切までの残り時間が1時間未満でない限り、通知同士の間隔は最低でも1時間以上空けてください。締切まで期間が長い場合は、1日後・3日後・1週間後など十分な間隔を確保してください
- 締切が設定されていない場合は、現在時刻の2分後、4時間後・8時間後・1日後・2日後・5日後といった、最低でも4時間以上の間隔を空けたスケジュールを基準に、3〜5件の通知を配置してください
- 勿論、最後の通知のタイトルは全体を包括した内容が完了しているか聞いてください
- due_dateは時系列で昇順になるように設定し、全ての通知を締切より前（または締切がない場合は適切な将来の時刻）に設定してください
- 各通知のタイトルは、タスク名を含めた親しみやすい問いかけや呼びかけ形式にしてください（例：「○○の進捗はどうですか」「○○は終わりましたか」「○○に一緒に取り組みましょう」など、通知のタイトルとして適切な形式で記述してください）
- 各通知の本文は150文字程度で、すぐに実行できる具体的なアクションや問いかけを含め、ユーザーが次に何をすればよいかが明確になるようにしてください
- 期限超過時の「事後確認」通知が必要な場合は、締切直後に続けて配置し、リカバリや次のアクションを促してください
- 通知が重複したり内容が似通いすぎないよう注意し、全体として計画的な進行を支援する構成にしてください

通知が必要ない場合（例: タスクが既に完了している場合）は空の配列を返してください。"""
    )
])


# バッチ処理用プロンプト（複数タスクをまとめて処理）
batch_prompt_template = ChatPromptTemplate.from_messages([
    (
        "system",
        "あなたは複数のタスク情報から適切な通知を生成する専門家です。"
        "複数のタスクが同じノートから生成されている場合、関連性を考慮して通知を統合してください。"
        "すべての内容は必ず日本語で記述してください。"
    ),
    (
        "user",
        """以下の複数タスク情報を分析して、ユーザーに送る通知を生成してください。

現在の日時: {current_datetime}

タスクリスト:
{tasks_info}

要求:
- 通知は必ず日本語で記述してください
- タスクリスト全体に対して3〜5件の通知を生成し、必要に応じて関連タスクを1つの通知にまとめてください
- 最初の通知は現在時刻の約2分後~1時間後に設定し、複数タスクに共通して取り掛かれる最初の一歩を提案してください
- 最終の通知は対象タスク群の最も早い締切ちょうどに設定し、完了確認やフォローアップを促してください
- 残りの通知は上記2つの間にほぼ等間隔で配置し、進捗レビュー、計画調整、モチベーション向上など異なる観点を扱ってください
- 締切までの残り時間が1時間未満でない限り、通知同士の間隔は最低でも1時間以上空けてください。締切が遠い場合は1日後・3日後・1週間後など適切な間隔を活用してください
- 締切がない、あるいはタスクによって締切がばらつく場合は、代表となる期限やタスクの性質を踏まえて、現在時刻、4時間後・8時間後・1日後・2日後・5日後といった、最低でも4時間以上の間隔を空けたスケジュールを基準に3〜5件の通知を配置してください
- 勿論、最後の通知のタイトルは全体を包括した内容が完了しているか聞いてください
- due_dateは昇順になるように設定し、各通知が適切な順序で実行されるようにしてください
- 各通知のタイトルは、タスク名を含めた親しみやすい問いかけや呼びかけ形式にしてください（例：「○○の進捗はどうですか」「○○は終わりましたか」「○○に一緒に取り組みましょう」など、通知のタイトルとして適切な形式で記述してください）。複数タスクを扱う場合は、主要なタスク名やグループ名を含めてください
- 各通知の本文は150〜200文字程度で、すぐに実行できる具体的なアクションや確認事項を明確にし、複数タスクを扱う場合は関係するタスク名やグループ名を明示してください
- 締切超過が想定される場合は締切直後のフォローアップ通知を追加し、リカバリ策や次のアクションを提示してください
- 通知内容や timing が重複しないように工夫し、全体として計画的な進行を支援してください

通知が必要ない場合は空の配列を返してください。"""
    )
])

